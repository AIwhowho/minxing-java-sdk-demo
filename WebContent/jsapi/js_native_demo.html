<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>敏行V5 Html5 JSAPI测试</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <script type="text/javascript" src="cordova.js"></script>
    <style>
    body {
    background: #eee;
    font-size: 1.2em;
    }
    .field input,.field input:focus {
    background: #fff;
    width: 100%;
    border: none;
    padding: .4em 0;
    margin: 0;
    display: block;
    outline: 0 !important;
    min-height: 1.4em;
    line-height: 1.4em;
    font-size: 16px;
    -webkit-user-modify: read-write-plaintext-only ;
    -webkit-tap-highlight-color: rgba(255, 255, 255, 0) !important;
    }
    .field {
    background-color: #fff;
    border: 1px solid #aaaaaa;
    color: #333333;
    text-shadow: 0 1px 0 white;
    -webkit-border-radius: 0.6em;
    border-radius: 0.6em;
    margin: .5em 0;
    padding:0 .4em 0 .4em;
    -webkit-background-clip: padding;
    background-clip: padding-box;
    width: 80%;
    font-size: 1.2em;
    }
    .btn {
    border: 1px solid #044062;
    background: #8B2500;
    font-weight: bold;
    color: white;
    text-shadow: 0 1px 0 #194b7e;
    background-image: -webkit-gradient(linear, left top, left bottom, from(#5f9cc5), to(#8B2500));
    background-image: -webkit-linear-gradient(#5f9cc5, #8B2500);
    background-image: -moz-linear-gradient(#5f9cc5, #8B2500);
    background-image: -ms-linear-gradient(#5f9cc5, #8B2500);
    background-image: -o-linear-gradient(#5f9cc5, #8B2500);
    background-image: linear-gradient(#5f9cc5, #8B2500);
    width: 100%;
    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    font-size : 20px;
    color : #ffffff;
    background-color : #4b88b6;
    -webkit-border-radius: 1em;
    border-radius: 1em;
    padding: 0.4em 0;
    cursor: pointer;
    display: inline-block;
    text-align: center;
    text-decoration:none;
    margin-bottom: 0.4em;
    }
    input {

    }
    </style>
    <body>
        <div>
            MXCommon.download('url')
            <input type="text" id="downloadurl" size=30 value="http://intg.dehuinet.com:8060/clients_file/2.apk"><a onclick="clear_input('downloadurl')">清空</a>
            <input type="button" class="btn" value="点击下载附件" onclick="download1()" id="download1">
        </div>
        <div>
            MXWebui.hideOptionMenu();
            <input type="button" class="btn" value="隐藏右上角分享按钮" onclick="hideOptionMenu()" id="hideOptionMenu">
        </div>
        <div>
            MXWebui.showOptionMenu()
            <input type="button" class="btn" value="显示右上角分享按钮" onclick="showOptionMenu()" id="showOptionMenu">
        </div>
        <div>
            MXWebui.hideWebViewTitle()
            <input type="button" class="btn" value="隐藏页面上部标题栏" onclick="hideWebViewTitle()" id="hideWebViewTitle">
        </div>
        <div>
            MXWebui.showWebViewTitle("---该页面标题---")
            <input type="button" class="btn" value="显示页面上部标题栏" onclick="showWebViewTitle()" id="showWebViewTitle">
        </div>
        <div>
            MXWebui.hideToolbar()
            <input type="button" class="btn" value="隐藏页面下部工具栏" onclick="hideToolbar()" id="hideToolbar">
        </div>
        <div>
            MXWebui.showToolbar()
            <input type="button" class="btn" value="显示页面下部工具栏" onclick="showToolbar()" id="showToolbar">
        </div>
        <div>
            MXWebui.closeWindow()
            <input type="button" class="btn" value="关闭当前页面" onclick="closeWindow()" id="closeWindow">
        </div>
        <div>
            MXWebui.disableBackKey()
            <input type="button" class="btn" value="禁用android back键" onclick="disableBackKey()" id="disableBackKey">
        </div>
        <div>
            MXContacts.selectUser(function(d){//获取返回的JSON结果},isDepSelectEnable)
            开启可以选中部门
            <input type="checkbox" name="isDepSelectEnable" id="isDep">
            <input type="button" class="btn" value="单选人员" onclick="selectUser()" id="selectUser">
            <div style="color:green" id="selectUserResult"></div>
        </div>
        <div>
            MXContacts.selectUsers(function(d){//获取返回的JSON结果},isDepSelectEnable)
            开启可以选中部门
            <input type="checkbox" name="isDepSelectEnableMulti" id="isDepMulti">
            <input type="button" class="btn" value="多选人员" onclick="selectUsers()" id="selectUsers">
            <div style="color:green" id="selectUsersResult"></div>
        </div>
        <div>
            MXChat.chat("['login_name1','login_name2']",function(){})
            <input type="text" id="login_name_chat" value="|分隔的多个login_name">
            <a onclick="clear_input('login_name_chat')">清空</a>
            <input type="button" class="btn" value="发起聊天会话" onclick="chat()" id="chat">
        </div>
        <div>
            MXChat.deleteMsg("messageid",function(){})
            <input type="text" id="messageid" value="消息id">
            <input type="button" class="btn" value="删除消息" onclick="deleteMsg()" id="chat">
        </div>
        <div>
            MXCommon.api({'method':'get','url':'/api/***','params':'a=a&b=b','headers':'h=ha'}, function(d){//获取返回的JSON结果})
            <input type="text"  id="apimethod" value="get">
            <input type="text"  id="apiurl" value="/api/v1/departments/3">
            <input type="text"  id="apiparams" value="a=a&b=b">
            <input type="text"  id="apiheaders" value="h=ha">
            <a onclick="clear_input('input_api')">清空</a>
            <input type="button" class="btn" value="发起API请求" onclick="api()" id="api">
            <div style="color:green" id="apiResult"></div>
        </div>
        <div>
            MXCommon.getPersonInfo("实际的login_name",function(d){//获取返回的JSON结果})
            <input type="text" id="login_name_personInfo" value="输入login_name">
            <a onclick="clear_input('login_name_personInfo')">清空</a>
            <input type="button" class="btn" value="获取人员信息" onclick="personInfo()" id="personInfo">
            <div style="color:green" id="personInfoResult"></div>
        </div>
        <div>
            MXCommon.viewPersonInfo("实际的login_name")
            <input type="text" id="login_name_viewPersonInfo"  value="输入login_name">
            <a onclick="clear_input('login_name_viewPersonInfo')">清空</a>
            <input type="button" class="btn" value="查看人员信息" onclick="viewPersonInfo()" id="viewPersonInfo">
        </div>
        <div>
            MXCommon.getCurrentUser(function(d){//获取返回的JSON结果})
            <input type="button" class="btn" value="当前用户信息" onclick="currentUser()" id="currentUser">
            <div style="color:green" id="currentUserResult"></div>
        </div>
        <div>
            MXCommon.getSSOToken("appid")
            <input type="text" id="appid"  value="输入appid">
            <input type="button" class="btn" value="获取ssotoken" onclick="getSSOToken()" id="getSSOToken">
            <div style="color:green" id="SSOTokenResult"></div>
        </div>
        <div>
            MXCommon.getServerUrl()
            <input type="button" class="btn" value="获取serverurl" onclick="getServerUrl()" id="getServerUrl">
            <div style="color:green" id="serverurlresult"></div>
        </div>
        <div>
            分享消息、创建opengraph共用字段：
            <input type="text" id="title"  value="输入title">
            <input type="text" id="thumbnail"  value="输入缩略图地址">
            <input type="text" id="url"  value="输入url">
            <input type="text" id="appUrl"  value="输入appUrl">
            <input type="text" id="desc"  value="输入desc">
            <input type="text" id="source_id"  value="输入source_id">
            <input type="text" id="source_type"  value="输入ocu或app">
            <br>
            分享消息sharelink内容<br>
            MXShare.shareToChat({'title':'Title','image_url':'thumbnail', 'url':'url', 'app_url':'appUrl', 'description':'desc', 'source_id':'notification','source_type':'ocu||app'})
            <input type="button" class="btn" value="sharelink到敏信会话" onclick="shareToChat()" id="shareToChat">
             MXShare.shareToCircle({'title':'Title','image_url':'thumbnail', 'url':'url', 'app_url':'appUrl', 'description':'desc', 'source_id':'notification','source_type':'ocu||app'})
            <input type="button" class="btn" value="sharelink到工作圈" onclick="shareToCircle()" id="shareToCircle">
            创建opengraph到会话聊天
            <br>
            MxChat.createGraph({'title':'Title','image_url':'thumbnail', 'url':'url', 'app_url':'appUrl', 'description':'desc', 'uids':['loginname', 'loginname']})
            <input type="text" id="uid1"  value="输入用户loginname">
            <input type="text" id="uid2"  value="输入用户loginname">
            <input type="button" class="btn" value="发送opengraph" onclick="createGraph()" id="createGraph">
        </div>
        <div>
            <input type="button" class="btn" value="设置cookie" onclick="setCookieValue()" id="setCookieValue">
            <input type="button" class="btn" value="显示cookie" onclick="showCookieValue()" id="showCookieValue">
            <div id="cookievalue"></div>
        </div>
    </body>
    <script>
    _={
        get:function (id) {
            return document.getElementById(id).value;
        }
    };
    _$={
        get:function (id) {
            return document.getElementById(id);
        }
    };
    function clear_input(id){
        _$.get(id).value='';
    }
    function hideOptionMenu () {
        MXWebui.hideOptionMenu();;
    }
    function showOptionMenu () {
         MXWebui.showOptionMenu();
    }
    function hideWebViewTitle () {
        MXWebui.hideWebViewTitle();
    }
    function showWebViewTitle () {
        MXWebui.showWebViewTitle("页面标题名称");
    }
    function hideToolbar () {
        MXWebui.hideToolbar();
    }
    function showToolbar () {
        MXWebui.showToolbar();
    }
    function closeWindow () {
        MXWebui.closeWindow();
    }
    function disableBackKey(){
        MXWebui.disableBackKey();
    }
    function selectUser () {
        MXContacts.selectUser(function(result){
            _$.get("selectUserResult").innerHTML=JSON.stringify(result);
        },_$.get("isDep").checked);
    }
    function selectUsers () {
        MXContacts.selectUsers(function(result){
            _$.get("selectUsersResult").innerHTML=JSON.stringify(result);
        },_$.get("isDepMulti").checked);
    }
    function chat () {
        var v = _.get("login_name_chat").split("|");
        MXChat.chat(v);
    }
    function deleteMsg () {
        var v = _.get("messageid");
        MXChat.deleteMsg(v,function(result){
            alert("ok");
        });
    }
    function getSSOToken () {
        var v = _.get("appid");
        MXCommon.getSSOToken(v
            ,function(result){
            _$.get("SSOTokenResult").innerHTML=result;
        });
    }
    function getServerUrl () {
        MXCommon.getServerUrl(function(result){
            _$.get("serverurlresult").innerHTML=result;
        });
    }
    function api () {
        var method = _.get("apimethod")
        var url = _.get("apiurl")
        var params = _.get("apiparams")
        var headers = _.get("apiheaders")
        MXCommon.api({'method':method,'url':url,'params':params,'headers':headers},function(result){
            _$.get("apiResult").innerHTML=JSON.stringify(result);
        });
    }
    function personInfo () {
        var v = _.get("login_name_personInfo");
        MXCommon.getPersonInfo(v,function(result){
            _$.get("personInfoResult").innerHTML=JSON.stringify(result);
        });
    }
    function viewPersonInfo () {
        var v = _.get("login_name_viewPersonInfo")
        MXCommon.viewPersonInfo(v);
    }
    
    function shareToChat () {
        var title = _.get("title")
        var thumbnail = _.get("thumbnail")
        var url = _.get("url")
        var appUrl = _.get("appUrl")
        var desc = _.get("desc")
        var source_id = _.get("source_id")
        var source_type = _.get("source_type")
        MXShare.shareToChat({'title':title,'thumbnail':thumbnail, 'url':url, 'appUrl':appUrl, 'desc':desc, 'source_id':source_id, 'source_type':source_type})
    }
    function shareToCircle () {
        var title = _.get("title")
        var thumbnail = _.get("thumbnail")
        var url = _.get("url")
        var appUrl = _.get("appUrl")
        var desc = _.get("desc")
        var source_id = _.get("source_id")
        var source_type = _.get("source_type")
        MXShare.shareToCircle({'title':title,'thumbnail':thumbnail, 'url':url, 'appUrl':appUrl, 'desc':desc, 'source_id':source_id, 'source_type':source_type})
    }
    function createGraph () {
        var title = _.get("title")
        var thumbnail = _.get("thumbnail")
        var url = _.get("url")
        var appUrl = _.get("appUrl")
        var desc = _.get("desc")
        var uid1 = _.get("uid1")
        var uid2 = _.get("uid2")
        MXChat.createGraph({'title':title,'image_url':thumbnail, 'url':url, 'app_url':appUrl, 'description':desc,  'uids':[uid1,uid2]})
    }
    
    function currentUser () {
        MXCommon.getCurrentUser(function(result){
            _$.get("currentUserResult").innerHTML=JSON.stringify(result);
        });
    }
    function launchApp () {
        var p;
        if (navigator.userAgent.match(/Android/)) {
            p = {"androidLancher":"com.tencent.mm://com.tencent.mm.ui.LauncherUI","androidInstallUrl":"http://weixin.qq.com/cgi-bin/readtemplate?uin=&stype=&promote=&fr=&lang=zh_CN&ADTAG=&check=false&t=weixin_download_method&sys=android&loc=weixin,android,web,0"};
        }else if (navigator.userAgent.match(/iPhone/) || navigator.userAgent.match(/iPod/) ){
            p = {"iosScheme":"weixin://?a=a&b=b","iosDownloadUrl":"http://itunes.apple.com/cn/app/id414478124"};
        }
        
        MXBridge.invoke("launchApp",p);
    }
    
    function download1(){
        var v = _.get("downloadurl")
        MXCommon.download(v);
    }
    function download2(){
        MXCommon.download("http://intg.dehuinet.com:8060/clients_file/iOS.ipa");
    }
    function download3(){
        MXCommon.download("http://192.168.100.77:8080/mx-test4dev/download");
    }
    function showCookieValue(){
        _$.get("cookievalue").innerHTML = document.cookie;
    }
    function setCookieValue(){
        setCookie("test","testvalue",4);
    }
    function setCookie(c_name,value,expiredays)
    {
    var exdate=new Date()
    exdate.setDate(exdate.getDate()+expiredays)
    document.cookie=c_name+ "=" +escape(value)+
    ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())
    }
    </script>

</html>